# 持久化变量UI显示效果详解

## 📋 概述

持久化变量通过 `VariableStateDisplay` 组件在用户界面中显示，采用折叠式设计，既节省空间又能提供详细的信息展示。

## 🎨 折叠状态显示

### 默认折叠状态

当有变量状态时，在任务头部下方会显示一个紧凑的变量状态栏：

```
┌─────────────────────────────────────────────────────────────┐
│ 📝 任务标题内容...                                          │
│ 当前角色: 某个角色 - 角色描述                              │
│ [变量图标] variableName: "variableValue"    🗃️  3        │
└─────────────────────────────────────────────────────────────┘
```

### 组件元素说明

| 元素 | 描述 | 样式 | 颜色 |
|------|------|------|------|
| **变量图标** | 根据最重要的变量类型显示 | w-3 h-3 | 蓝色/绿色/黄色/红色 |
| **变量名** | 最重要的变量名称 | 12px, 500权重 | 根据类型动态 |
| **变量值** | 格式化后的变量值 | 12px, 单行显示 | 绿色 |
| **数据库图标** | 🗃️ 表示变量存储 | 12px | 蓝色 |
| **计数器** | 显示变量总数 | 12px, 500权重 | 灰色 |

### 图标含义

| 变量类型 | 图标 | 颜色 | 含义 |
|---------|------|------|------|
| `set` | ✏️ Edit | 蓝色 | 设置变量值 |
| `add` | ➕ Plus | 绿色 | 增加数值 |
| `insert` | 🗄️ Database | 黄色 | 插入数据 |
| `remove` | ➖ Minus | 红色 | 删除数据 |

## 📖 展开状态显示

点击折叠状态栏后会展开详细的面板：

```
┌─────────────────────────────────────────────────────────────┐
│ 📝 任务标题内容...                                          │
│ 当前角色: 某个角色 - 角色描述                              │
│ [变量图标] variableName: "variableValue"    🗃️  3        │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🗄️ Variables           3 variables              ▲      │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ ✏️ playerName                                         │ │
│ │    Set playerName                                      │ │
│ │    "Alice"                                             │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ ➕ score                                               │ │
│ │    Add 100 to score                                    │ │
│ │    150                                                 │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ 🗄️ inventory                                           │ │
│ │    Insert into inventory                               │ │
│ │    ["sword", "potion"]                                 │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 展开面板特性

#### 🎯 面板头部
- **数据库图标** 🗄️ - 表示变量数据存储
- **标题** "Variables" - 面板名称
- **变量计数** - 显示当前变量总数
- **关闭按钮** ▲ - 点击收起面板

#### 📝 变量列表项
每个变量显示以下信息：

```
┌─────────────────────────────────────────┐
│ [图标] variableName                    │
│        操作描述                          │
│        "变量值"                         │
└─────────────────────────────────────────┘
```

#### 🎨 样式细节

| 元素 | 字体大小 | 颜色 | 权重 |
|------|----------|------|------|
| 变量名 | 13px | 前景色 | 600 |
| 操作描述 | 11px | 描述色 | 正常 |
| 变量值 | 11px | 绿色 | 正常 |
| 分隔线 | 1px | 面板边框色 | - |

## 🔄 交互效果

### 🖱️ 鼠标交互

1. **悬停效果**：
   - 折叠状态栏：鼠标悬停时显示指针光标
   - 关闭按钮：悬停时背景高亮，透明度变化

2. **点击行为**：
   - 点击折叠栏：展开/收起面板
   - 点击关闭按钮：收起面板
   - 点击背景遮罩：收起面板

### ⌨️ 键盘交互

- **ESC键**：收起展开的面板
- **Tab键**：在可交互元素间切换焦点

## 📱 响应式设计

### 📏 尺寸规范

| 状态 | 最小宽度 | 最大宽度 | 高度 |
|------|----------|----------|------|
| 折叠状态 | 200px | 100% | 32px |
| 展开面板 | 300px | 100% | 200-400px |

### 📐 布局适配

- **小屏幕**：面板宽度自适应，支持水平滚动
- **大屏幕**：面板最大宽度限制，保持良好的阅读体验

## 🎯 实际显示示例

### 示例1：游戏角色变量

```typescript
// 变量数据
{
  playerName: "Alice",
  level: 15,
  health: 100,
  inventory: ["sword", "potion", "shield"]
}
```

**折叠显示**：
```
✏️ playerName: "Alice"    🗃️  4
```

**展开显示**：
```
🗄️ Variables           4 variables              ▲
├─────────────────────────────────────────────────────────┤
│ ✏️ playerName                                         │
│    Set playerName                                      │
│    "Alice"                                             │
├─────────────────────────────────────────────────────────┤
│ ➕ level                                               │
│    Add 5 to level                                       │
│    15                                                  │
├─────────────────────────────────────────────────────────┤
│ ✏️ health                                              │
│    Set health                                          │
│    100                                                 │
├─────────────────────────────────────────────────────────┤
│ 🗄️ inventory                                           │
│    Insert into inventory                               │
│    ["sword", "potion", "shield"]                       │
└─────────────────────────────────────────────────────────┘
```

### 示例2：配置变量

```typescript
// 配置数据
{
  theme: "dark",
  language: "zh-CN",
  autoSave: true,
  maxHistory: 50
}
```

**折叠显示**：
```
✏️ theme: "dark"    🗃️  4
```

**展开显示**：
```
🗄️ Variables           4 variables              ▲
├─────────────────────────────────────────────────────────┤
│ ✏️ theme                                               │
│    Set theme                                           │
│    "dark"                                              │
├─────────────────────────────────────────────────────────┤
│ ✏️ language                                            │
│    Set language                                        │
│    "zh-CN"                                             │
├─────────────────────────────────────────────────────────┤
│ ✏️ autoSave                                            │
│    Set autoSave                                        │
│    true                                                 │
├─────────────────────────────────────────────────────────┤
│ ➕ maxHistory                                          │
│    Add 50 to maxHistory                                │
│    50                                                   │
└─────────────────────────────────────────────────────────┘
```

## 🎨 视觉设计原则

### 🌈 颜色方案

组件使用VSCode主题色彩系统，确保与编辑器界面的一致性：

```css
/* 主要颜色 */
--vscode-editor-background: 编辑器背景色
--vscode-foreground: 前景色
--vscode-panel-border: 面板边框色
--vscode-descriptionForeground: 描述文字色
--vscode-toolbar-hoverBackground: 工具栏悬停背景

/* 终端颜色（用于图标和值） */
--vscode-terminal-ansiBlue: 蓝色（set操作）
--vscode-terminal-ansiGreen: 绿色（变量值）
--vscode-terminal-ansiYellow: 黄色（insert操作）
--vscode-terminal-ansiRed: 红色（remove操作）
```

### 📐 间距规范

- **内边距**：6px 10px（折叠状态），12px 16px（展开面板）
- **间距**：2px（图标与文字），4px（元素组），8px（变量项），12px（分隔）
- **圆角**：6px（展开面板），0px（折叠状态）

### 🔤 字体规范

- **变量名**：13px, 600权重，支持换行
- **描述文字**：11px, 正常权重
- **变量值**：11px, 等宽字体
- **计数器**：12px, 500权重

## 🚀 性能优化

### ⚡ 渲染优化

1. **useMemo缓存**：变量解析和状态计算使用缓存
2. **虚拟滚动**：大量变量时使用虚拟滚动（未来版本）
3. **懒加载**：面板内容按需渲染

### 💾 内存优化

1. **事件清理**：组件卸载时清理事件监听器
2. **引用管理**：使用useRef避免不必要的重渲染
3. **状态简化**：最小化组件内部状态

## 🔧 自定义配置

### 🎛️ 可配置选项

```typescript
interface VariableStateDisplayProps {
  variables?: string[]          // 变量命令数组
  className?: string           // 自定义CSS类名
  theme?: 'light' | 'dark'     // 主题模式（预留）
  maxHeight?: number          // 面板最大高度（预留）
  showIcons?: boolean         // 是否显示图标（预留）
}
```

### 🎨 样式自定义

可以通过CSS变量覆盖默认样式：

```css
.variable-state-display {
  --background-color: custom-bg;
  --border-color: custom-border;
  --text-color: custom-text;
}
```

## 📱 使用场景

### 🎮 游戏开发
- 角色属性追踪
- 游戏状态管理
- 配置参数显示

### 💼 业务应用
- 用户偏好设置
- 系统配置展示
- 状态监控面板

### 🔧 开发工具
- 调试信息显示
- 环境变量展示
- 配置状态查看

## 🎯 总结

持久化变量的UI显示设计遵循了以下原则：

1. **信息层次清晰**：折叠显示概要，展开显示详情
2. **视觉一致性**：与VSCode主题系统保持一致
3. **交互友好**：直观的点击展开/收起操作
4. **性能优化**：智能缓存和按需渲染
5. **可扩展性**：支持不同类型和数量的变量

这种设计既节省了界面空间，又提供了完整的变量状态信息，为用户提供了良好的使用体验。
